<div class='post' data-date='{{ p.posted_date }}'>

{% if p.viewable_by(g.user, g.date) %}

<div class='post_top'>
  <span class='post_date' title="{{ p.posted_date | prettydate }}">
    {% block post_date %}
    {% endblock %}
  </span>
  <span class="post_controls">
    {% block post_controls %}
    {% endblock %}
  </span>
</div>
<hr />
<div class='post_body'>
  {% block post_body %}
  {% endblock %}
</div>
{% block post_bottomstuff %}
{% endblock %}

{% else %}

<div class='post_top hidden'>
  <span class='post_date' title="{{ p.posted_date | prettydate }}">
    {{ p.posted_date | nicedate }} - hidden
  </span>
</div>

{% endif %}
</div>
